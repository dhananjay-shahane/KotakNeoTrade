{% extends "base.html" %}

{% block title %}Charts - Kotak Neo Trading{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/charts.css') }}">
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
{% endblock %}

{% block content %}
<!-- Charts Skeleton Loader -->
<div class="charts-skeleton" id="chartsSkeleton">
    <!-- Header Skeleton -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <div class="skeleton-title mb-2"></div>
            <div class="skeleton-subtitle"></div>
        </div>
        <div class="skeleton-button"></div>
    </div>

    <!-- Search Bar Skeleton -->
    <div class="card bg-secondary mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-8 mb-3">
                    <div class="skeleton-search-input"></div>
                </div>
                <div class="col-md-4">
                    <div class="skeleton-search-btn"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart Container Skeleton -->
    <div class="row">
        <div class="col-12">
            <div class="card bg-secondary">
                <div class="card-header">
                    <div class="skeleton-chart-header"></div>
                </div>
                <div class="card-body">
                    <div class="skeleton-chart-container">
                        <div class="skeleton-chart-placeholder">
                            <div class="skeleton-chart-icon"></div>
                            <div class="skeleton-chart-text"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Actual Charts Content -->
<div class="charts-content" id="chartsContent" style="display: none;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">Trading Charts</h1>
            <p class="text-muted mb-0">Interactive price charts and technical analysis</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-light" id="clearAllBtn">
                <i class="fas fa-trash me-1"></i>Clear All
            </button>
            <button class="btn btn-primary" id="connectBtn">
                <i class="fas fa-wifi me-1"></i>Real-time Feed
            </button>
        </div>
    </div>

    <div class="row g-3">
        <!-- Left Panel for Symbol Search -->
        <div class="col-lg-3 col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Symbol Search</h6>
                </div>
                <div class="card-body p-3">
                    <!-- Search Input -->
                    <div class="mb-3 search-container">
                        <input type="text" class="form-control symbol-search" id="symbolSearch" 
                               placeholder="Search stocks, ETFs..." autocomplete="off">
                        <div class="search-results" id="searchResults">
                            <!-- Search results will be populated here -->
                        </div>
                    </div>

                    <!-- Selected Symbols -->
                    <div class="mb-3">
                        <h6 class="text-uppercase text-secondary mb-2" style="font-size: 0.75rem;">Selected Symbols</h6>
                        <div class="selected-symbols" id="selectedSymbols">
                            <!-- Selected symbols will appear here -->
                        </div>
                    </div>



                    <!-- Timeframe Controls -->
                    <div class="mb-3">
                        <h6 class="text-uppercase text-secondary mb-2" style="font-size: 0.75rem;">Timeframe</h6>
                        <div class="timeframe-controls">
                            <button class="timeframe-btn" data-period="1D">1D</button>
                            <button class="timeframe-btn active" data-period="1W">1W</button>
                            <button class="timeframe-btn" data-period="1M">1M</button>
                            <button class="timeframe-btn" data-period="3M">3M</button>
                            <button class="timeframe-btn" data-period="1Y">1Y</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chart Area -->
        <div class="col-lg-9 col-md-8">
            <div id="chartsContainer">
                <div class="no-charts-message" id="noChartsMessage">
                    <i class="fas fa-chart-line fa-3x mb-3"></i>
                    <h4>No Charts Selected</h4>
                    <p>Search and select symbols from the left panel to display charts</p>
                </div>
                <div class="chart-grid single" id="chartGrid" style="display: none;">
                    <!-- Charts will be dynamically added here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

<style>
/* Charts Skeleton CSS */
.charts-skeleton {
    animation: fadeIn 0.3s ease-in;
}

.skeleton-title {
    height: 28px;
    width: 160px;
    background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 4px;
}

.skeleton-subtitle {
    height: 16px;
    width: 280px;
    background: linear-gradient(90deg, rgba(255,255,255,0.08) 25%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.08) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 4px;
}

.skeleton-button {
    height: 40px;
    width: 120px;
    background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 6px;
}

.skeleton-search-input {
    height: 42px;
    width: 100%;
    background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 6px;
}

.skeleton-search-btn {
    height: 42px;
    width: 100%;
    background: linear-gradient(90deg, rgba(255,255,255,0.15) 25%, rgba(255,255,255,0.25) 50%, rgba(255,255,255,0.15) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 6px;
}

.skeleton-chart-header {
    height: 20px;
    width: 180px;
    background: linear-gradient(90deg, rgba(255,255,255,0.15) 25%, rgba(255,255,255,0.25) 50%, rgba(255,255,255,0.15) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 4px;
}

.skeleton-chart-container {
    height: 400px;
    background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

.skeleton-chart-placeholder {
    text-align: center;
}

.skeleton-chart-icon {
    height: 80px;
    width: 80px;
    background: linear-gradient(90deg, rgba(255,255,255,0.15) 25%, rgba(255,255,255,0.25) 50%, rgba(255,255,255,0.15) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 50%;
    margin: 0 auto 1rem;
}

.skeleton-chart-text {
    height: 16px;
    width: 160px;
    background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 4px;
    margin: 0 auto;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
</style>

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show skeleton initially
    document.getElementById('chartsSkeleton').style.display = 'block';
    document.getElementById('chartsContent').style.display = 'none';

    // Hide skeleton after content loads
    setTimeout(function() {
        hideChartsSkeleton();
    }, 2000);
});

function hideChartsSkeleton() {
    const skeleton = document.getElementById('chartsSkeleton');
    const content = document.getElementById('chartsContent');

    if (skeleton && content) {
        skeleton.style.transition = 'opacity 0.5s ease-out';
        skeleton.style.opacity = '0';

        setTimeout(function() {
            skeleton.style.display = 'none';
            content.style.display = 'block';
            content.style.opacity = '0';
            content.style.transition = 'opacity 0.5s ease-in';

            setTimeout(function() {
                content.style.opacity = '1';
            }, 50);
        }, 500);
    }
}
</script>
<script src="{{url_for('static',filename="js/charts.js")}}"></script>
{% endblock %}