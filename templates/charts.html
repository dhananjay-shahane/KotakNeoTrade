{% extends "base.html" %}
{% block title %}Charts - Trading Signals{% endblock %}

{% block head %}
<style>
    .charts-container {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .dash-iframe {
        width: 100%;
        height: 800px;
        border: none;
        border-radius: 10px;
        background: #1e1e1e;
    }

    .fallback-chart {
        text-align: center;
        padding: 4rem;
        background: var(--card-bg);
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .chart-controls {
        display: flex;
        gap: 10px;
    }

    .chart-btn {
        padding: 8px 16px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .chart-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="charts-container">
                <div class="chart-header">
                    <h2><i class="fas fa-chart-area me-2"></i>Interactive Trading Charts</h2>
                    <div class="chart-controls">
                        {% if dash_url %}
                        <button class="chart-btn" onclick="refreshChart()">
                            <i class="fas fa-sync me-1"></i>Refresh
                        </button>
                        <a href="{{ dash_url }}" target="_blank" class="chart-btn">
                            <i class="fas fa-external-link-alt me-1"></i>Full Screen
                        </a>
                        {% endif %}
                    </div>
                </div>

                {% if dash_url %}
                <div class="dash-chart-container">
                    <iframe src="{{ dash_url }}" class="dash-iframe" id="dashChart"></iframe>
                </div>
                {% else %}
                <div class="fallback-chart">
                    <i class="fas fa-chart-line fa-4x text-muted mb-3"></i>
                    <h3>Charts Unavailable</h3>
                    <p class="text-muted">
                        Interactive charts are currently unavailable. 
                        Please install the required dependencies or use an alternative charting solution.
                    </p>
                    <div class="mt-4">
                        <button class="chart-btn" onclick="location.reload()">
                            <i class="fas fa-redo me-1"></i>Retry
                        </button>
                        <a href="/portfolio" class="chart-btn ms-2">
                            <i class="fas fa-arrow-left me-1"></i>Back to Portfolio
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Chart Information -->
            <div class="charts-container">
                <h4><i class="fas fa-info-circle me-2"></i>Chart Features</h4>
                <div class="row">
                    <div class="col-md-3">
                        <div class="feature-card">
                            <i class="fas fa-chart-candlestick fa-2x text-primary mb-2"></i>
                            <h6>Candlestick Charts</h6>
                            <p class="text-muted small">OHLC price visualization</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-card">
                            <i class="fas fa-calendar-alt fa-2x text-success mb-2"></i>
                            <h6>Multiple Timeframes</h6>
                            <p class="text-muted small">1D, 1W, 1M, 3M views</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-card">
                            <i class="fas fa-search fa-2x text-warning mb-2"></i>
                            <h6>Symbol Search</h6>
                            <p class="text-muted small">Search any stock symbol</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-card">
                            <i class="fas fa-sync fa-2x text-info mb-2"></i>
                            <h6>Real-time Updates</h6>
                            <p class="text-muted small">Live market data</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function refreshChart() {
    const iframe = document.getElementById('dashChart');
    if (iframe) {
        iframe.src = iframe.src;
    }
}

// Auto-refresh chart every 5 minutes
setInterval(function() {
    refreshChart();
}, 300000);
</script>
{% endblock %}