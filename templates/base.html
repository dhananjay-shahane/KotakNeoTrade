<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>{% block title %}Kotak Neo Trading{% endblock %}</title>

        <!-- Favicon -->
        <link
            rel="icon"
            type="image/x-icon"
            href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiMyNTYzZWIiLz4KPHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOCAxOCIgZmlsbD0ibm9uZSIgeD0iNyIgeT0iNyI+CjxwYXRoIGQ9Im0xIDkgNCA0TDE3IDEiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPHN2Zz4KPC9zdmc+"
        />

        <!-- Theme and Font Size persistence script -->
        <script>
            (function () {
                var savedTheme = localStorage.getItem("theme") || "dark";
                document.documentElement.setAttribute("data-theme", savedTheme);

                var savedFontSize =
                    localStorage.getItem("website-font-size") || "14";
                document.documentElement.style.setProperty(
                    "--global-font-size",
                    savedFontSize + "px",
                    );
            })();
        </script>

        <!-- Bootstrap 5 CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Font Awesome Icons -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <!-- SweetAlert2 CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
        />

        <!-- Custom CSS -->
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/base.css') }}"
        />

        {% block head %}{% endblock %}
    </head>
    <body>
        <!-- Fixed Header -->
        <header class="main-header">
            <div class="header-left">
                <button class="mobile-toggle me-3" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="{{ url_for('portfolio') }}" class="header-brand">
                    <i class="fas fa-chart-line"></i>
                    <span>Neo Trading</span>
                </a>
            </div>

            <div class="header-right">
                <!-- Settings Button -->
                <button
                    class="settings-btn me-3"
                    onclick="showSettingsModal()"
                    title="Application Settings"
                >
                    <i class="fas fa-cog"></i>
                </button>

                <!-- Theme Toggle Switch -->
                <div class="theme-toggle">
                    <input
                        type="checkbox"
                        id="themeToggle"
                        class="theme-toggle-input"
                    />
                    <label
                        for="themeToggle"
                        class="theme-toggle-label"
                        title="Toggle theme"
                    >
                        <i class="fas fa-sun theme-icon-light"></i>
                        <i class="fas fa-moon theme-icon-dark"></i>
                        <span class="theme-toggle-slider"></span>
                    </label>
                </div>

                <!-- Notification Container -->
                <div class="notification-container">
                    <button
                        class="notification-btn"
                        onclick="toggleNotificationInbox()"
                    >
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount"
                            >0</span
                        >
                    </button>

                    <!-- Notification Inbox Dropdown -->
                    <div
                        class="notification-inbox"
                        id="notificationInbox"
                        style="display: none"
                    >
                        <div
                            class="notification-header flex justify-content-between align-items-center"
                        >
                            <h6>
                                <i class="fas fa-inbox me-2"></i>Notifications
                            </h6>
                            <button
                                class="btn-close-inbox"
                                onclick="closeNotificationInbox()"
                            >
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="notification-list" id="notificationList">
                            <div class="no-notifications">
                                <i class="fas fa-bell-slash"></i>
                                <p>No new notifications</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Profile -->
                {% if session.get('authenticated') %}
                <div class="user-profile" onclick="toggleUserMenu()">
                    <div class="user-avatar text-white">
                        {{ session.get('username', 'U')[0]|upper }}
                    </div>
                    <div class="user-info">
                        <h6>{{ session.get('username', 'User') }}</h6>
                    </div>
                    <i
                        class="fas fa-chevron-down"
                        style="font-size: 0.75rem; color: var(--text-secondary)"
                    ></i>
                </div>
                {% endif %}
            </div>
        </header>

        <!-- Sidebar Overlay for Mobile -->
        <div
            class="sidebar-overlay"
            id="sidebarOverlay"
            onclick="toggleSidebar()"
            style="display: none"
        ></div>

        <!-- Fixed Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-nav">
                <div class="nav-item">
                    <a href="{{ url_for('portfolio') }}" class="nav-link">
                        <i class="fas fa-briefcase nav-icon"></i>
                        <span>Portfolio</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="{{ url_for('trading_signals') }}" class="nav-link">
                        <i class="fas fa-chart-bar nav-icon"></i>
                        <span>Trading Signals</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="{{ url_for('deals') }}" class="nav-link">
                        <i class="fas fa-handshake nav-icon"></i>
                        <span>Deals</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="{{ url_for('default_deals') }}" class="nav-link">
                        <i class="fas fa-list nav-icon"></i>
                        <span>Default Deals</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="{{ url_for('show_charts') }}" class="nav-link">
                        <i class="fas fa-chart-line nav-icon"></i>
                        <span>Charts</span>
                    </a>
                </div>
            </div>

            <!-- Kotak Neo Trading Section (shown only after Kotak login) -->
            {% if session.get('kotak_logged_in') and session.get('login_type')
            == 'kotak_neo' %}
            <div
                class="kotak-neo-section"
                id="kotakNeoSection"
                style="display: block"
            >
                <div class="nav-items">
                    <div class="nav-item">
                        <a
                            href="{{ url_for('show_dashboard') }}"
                            class="nav-link"
                        >
                            <i class="fas fa-list-alt nav-icon"></i>
                            <span>Dashboard</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="{{ url_for('show_orders') }}" class="nav-link">
                            <i class="fas fa-list-alt nav-icon"></i>
                            <span>Orders</span>
                        </a>
                    </div>

                    <div class="nav-item">
                        <a
                            href="{{ url_for('show_positions') }}"
                            class="nav-link"
                        >
                            <i class="fas fa-chart-bar nav-icon"></i>
                            <span>Positions</span>
                        </a>
                    </div>

                    <div class="nav-item">
                        <a
                            href="{{ url_for('show_holdings') }}"
                            class="nav-link"
                        >
                            <i class="fas fa-briefcase nav-icon"></i>
                            <span>Holdings</span>
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Trading Accounts Section -->
            <div class="trading-accounts-section">
                <div class="accounts-header">
                    <h6>
                        <i class="fas fa-university me-2"></i>Trading Accounts
                    </h6>
                </div>

                <!-- Kotak Neo Account Box (shown only after Kotak login) -->
                {% if session.get('kotak_logged_in') and
                session.get('login_type') == 'kotak_neo' %}
                <div
                    class="kotak-account-box"
                    id="kotakAccountBox"
                    style="display: block"
                >
                    <div class="account-card">
                        <div class="account-header">
                            <div class="account-info">
                                <div class="account-title">
                                    <i class="fas fa-chart-line me-2"></i>
                                    <span>Kotak Neo</span>
                                    <span class="status-indicator online">
                                        <i class="fas fa-circle"></i>
                                        <span>Online</span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="account-details">
                            <div class="detail-row">
                                <span class="label">UCC</span>
                                <span class="value"
                                    >{{ session.get('ucc', 'N/A') }}</span
                                >
                            </div>
                            <div class="detail-row">
                                <span class="label">MOBILE</span>
                                <span class="value"
                                    >{{ session.get('mobile_number', 'N/A')
                                    }}</span
                                >
                            </div>
                            <div class="detail-row">
                                <span class="label">Last Login</span>
                                <span class="value">Just Now</span>
                            </div>
                        </div>

                        <div class="account-actions">
                            <button
                                class="btn-switch-account"
                                onclick="switchToKotakDashboard()"
                            >
                                <i class="fas fa-external-link-alt me-1"></i>
                                Switch
                            </button>
                            <a
                                href="#"
                                class="btn-logout-account"
                                onclick="logoutKotakOnly(event)"
                            >
                                <i class="fas fa-sign-out-alt"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <!-- Add Another Account Button (shown when logged in) -->
                <div
                    class="add-account-section"
                    id="addAccountSection"
                    style="display: none"
                >
                    <button class="btn-add-account" onclick="showLoginModal()">
                        <i class="fas fa-plus me-2"></i>Add Another Account
                    </button>
                </div>
                {% endif %}

                <!-- Login Button (shown when no Kotak account logged in) -->
                {% if not (session.get('kotak_logged_in') and
                session.get('login_type') == 'kotak_neo') %}
                <div class="account-login" id="accountLogin">
                    <a
                        href="{{ url_for('auth_routes.login') }}"
                        class="btn-login-account"
                    >
                        <i class="fas fa-sign-in-alt me-2"></i>Login Account
                    </a>
                </div>
                {% endif %}
            </div>
        </nav>

        <!-- User Dropdown Menu -->
        <div
            class="dropdown-menu position-absolute"
            id="userMenu"
            style="
                display: none;
                top: var(--header-height);
                right: 1rem;
                min-width: 200px;
            "
        >
            <h6 class="dropdown-header">
                <i class="fas fa-user me-2"></i>Account Details
            </h6>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#" onclick="showUserProfile()">
                <i class="fas fa-id-card me-2"></i>View Profile
            </a>
            <a class="dropdown-item" href="#" onclick="showForgetPasswordModal()">
                <i class="fas fa-key me-2"></i>Forget Password
            </a>
            <div class="dropdown-divider"></div>
            {% if session.get('authenticated') %}
            <a
                class="dropdown-item text-danger"
                href="{{ url_for('auth_routes.logout') }}"
            >
                <i class="fas fa-sign-out-alt me-2"></i>Logout
            </a>
            {% else %}
            <a
                class="dropdown-item text-primary"
                href="{{ url_for('auth_routes.trading_account_login') }}"
            >
                <i class="fas fa-sign-in-alt me-2"></i>Login
            </a>
            {% endif %}
        </div>

        <!-- User Profile Modal -->
        {% if session.get('authenticated') %}
        <div class="modal fade" id="userProfileModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header border-bottom border-secondary">
                        <h5 class="modal-title">
                            <i class="fas fa-user-circle me-2"></i>User Profile
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-4 text-center mb-4">
                                <div class="user-profile-avatar mb-3">
                                    <i
                                        class="fas fa-user-circle fa-5x text-primary"
                                    ></i>
                                </div>
                                <h4 class="text-muted">
                                    {{ session.get('username', 'Unknown') }}
                                </h4>
                                <span class="badge bg-success"
                                    >Active User</span
                                >
                            </div>
                            <div class="col-md-8">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-info-circle me-2"></i
                                    >Account Information
                                </h6>
                                <div class="row">
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >User ID</label
                                        >
                                        <div
                                            class="form-control bg-secondary text-muted border-0"
                                        >
                                            {% if session.get('authenticated')
                                            %} {{ session.get('username',
                                            'Unknown') }} {% else %} Guest {%
                                            endif %}
                                        </div>
                                    </div>
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >Account Status</label
                                        >
                                        <div
                                            class="form-control {% if session.get('authenticated') %}bg-success{% else %}bg-warning{% endif %} text-muted border-0"
                                        >
                                            <span class="text-muted"
                                                ><i
                                                    class="fas {% if session.get('authenticated') %}fa-check-circle{% else %}fa-exclamation-triangle{% endif %} me-1"
                                                ></i
                                                >{% if
                                                session.get('authenticated')
                                                %}Authenticated{% else %}Not
                                                Logged In{% endif %}</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >Login Time</label
                                        >
                                        <div
                                            class="form-control bg-secondary text-muted border-0"
                                        >
                                            <span id="loginTime">
                                                {% if
                                                session.get('authenticated') %}
                                                {{ session.get('login_time',
                                                'Recent') }} {% else %} Not
                                                logged in {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >Mobile Number</label
                                        >
                                        <div
                                            class="form-control bg-secondary text-muted border-0"
                                        >
                                            {% if session.get('authenticated')
                                            %} {{ session.get('mobile', 'Not
                                            available') }} {% else %} Not
                                            available {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12 mb-3">
                                        <label class="form-label text-muted"
                                            >Email Address</label
                                        >
                                        <div
                                            class="form-control bg-secondary text-muted border-0"
                                        >
                                            {% if session.get('authenticated')
                                            %} {{ session.get('email', 'Not
                                            available') }} {% else %} Not
                                            available {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="border-secondary" />

                        <h6 class="text-primary mb-3">
                            <i class="fas fa-info-circle me-2"></i>Session
                            Information
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="list-group list-group-flush">
                                    <div
                                        class="list-group-item bg-transparent text-muted border-secondary"
                                    >
                                        <i
                                            class="fas fa-clock me-2 text-info"
                                        ></i>
                                        Session Timeout:
                                        <span class="text-info">24HR</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="list-group list-group-flush">
                                    <div
                                        class="list-group-item bg-transparent text-muted border-secondary"
                                    >
                                        <i
                                            class="fas fa-database me-2 text-primary"
                                        ></i>
                                        Data Refresh:
                                        <span class="text-info">Real-time</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Forget Password Modal -->
        {% if session.get('authenticated') %}
        <div class="modal fade" id="forgetPasswordModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header border-bottom border-secondary">
                        <h5 class="modal-title">
                            <i class="fas fa-key me-2"></i>Reset Password
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <form id="forgetPasswordForm">
                            <div class="mb-3">
                                <label class="form-label text-muted">Current Username</label>
                                <div class="form-control bg-secondary text-muted border-0">
                                    {{ session.get('username', 'Unknown') }}
                                </div>
                            </div>
                            <!-- Current Password -->
                            <div class="mb-3">
                                <label for="oldPassword" class="form-label">Current Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" class="form-control" id="oldPassword" required>
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- New Password -->
                            <div class="mb-3">
                                <label for="newPassword" class="form-label">New Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" class="form-control" id="newPassword" required>
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Confirm Password -->
                            <div class="mb-3">
                                <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" class="form-control" id="confirmPassword" required>
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                Your password will be updated in the system database.
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Cancel
                        </button>
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="submitPasswordReset()"
                            id="resetPasswordBtn"
                        >
                            <i class="fas fa-save me-1"></i>Update Password
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Settings Modal -->
        <div class="modal fade" id="settingsModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header border-bottom border-secondary">
                        <h5 class="modal-title">
                            <i class="fas fa-cog me-2"></i>Application Settings
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <!-- Font Size Settings -->
                        <div class="settings-section">
                            <h6 class="mb-3">
                                <i class="fas fa-text-height me-2"></i>
                                Font Size Settings
                            </h6>
                            <div class="mb-3">
                                <label for="fontSizeSelect" class="form-label"
                                    >Choose Font Size:</label
                                >
                                <select id="fontSizeSelect" class="form-select">
                                    <option value="10">10px (Minimum)</option>
                                    <option value="11">11px</option>
                                    <option value="12">12px</option>
                                    <option value="13">13px</option>
                                    <option value="14" selected>
                                        14px (Default)
                                    </option>
                                    <option value="15">15px</option>
                                    <option value="16">16px</option>
                                    <option value="17">17px</option>
                                    <option value="18">18px</option>
                                    <option value="19">19px</option>
                                    <option value="20">20px (Maximum)</option>
                                </select>
                            </div>
                            <div
                                class="font-size-preview p-3 border rounded"
                                style="background: var(--dark-bg)"
                            >
                                <p class="mb-0">
                                    This is a preview of the selected font size.
                                    Your entire application will use this size.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Cancel
                        </button>
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="applySettings()"
                        >
                            Apply Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">{% block content %}{% endblock %}</main>

        <!-- Bootstrap 5 JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- SweetAlert2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- Custom JS -->
        <script src="{{ url_for('static', filename='js/skeleton_loader.js') }}"></script>
        <script src="{{ url_for('static', filename='js/base.js') }}"></script>

        {% block scripts %}{% endblock %}
    </body>
</html>