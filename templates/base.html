<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{% block title %}Kotak Neo Trading{% endblock %}</title>

        <!-- Theme and Font Size persistence script -->
        <script>
            (function () {
                var savedTheme = localStorage.getItem("theme") || "dark";
                document.documentElement.setAttribute("data-theme", savedTheme);

                var savedFontSize =
                    localStorage.getItem("website-font-size") || "14";
                document.documentElement.style.setProperty(
                    "--global-font-size",
                    savedFontSize + "px",
                );
            })();
        </script>

        <!-- Bootstrap 5 CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Font Awesome Icons -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <!-- SweetAlert2 CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
        />

        <!-- Custom CSS -->
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/base.css') }}"
        />

        {% block head %}{% endblock %}
    </head>
    <body>
        <!-- Fixed Header -->
        <header class="main-header">
            <div class="header-left">
                <button class="mobile-toggle me-3" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="{{ url_for('portfolio') }}" class="header-brand">
                    <i class="fas fa-chart-line"></i>
                    <span>Neo Trading</span>
                </a>
            </div>

            <div class="header-right">
                <!-- Settings Button -->
                <button
                    class="settings-btn me-3"
                    onclick="showSettingsModal()"
                    title="Application Settings"
                >
                    <i class="fas fa-cog"></i>
                </button>

                <!-- Theme Toggle Switch -->
                <div class="theme-toggle">
                    <input
                        type="checkbox"
                        id="themeToggle"
                        class="theme-toggle-input"
                    />
                    <label for="themeToggle" class="theme-toggle-label">
                        <i class="fas fa-sun theme-icon-light"></i>
                        <i class="fas fa-moon theme-icon-dark"></i>
                        <span class="theme-toggle-slider"></span>
                    </label>
                </div>

                <!-- Notification Container -->
                <div class="notification-container">
                    <button
                        class="notification-btn"
                        onclick="toggleNotificationInbox()"
                    >
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount"
                            >0</span
                        >
                    </button>

                    <!-- Notification Inbox Dropdown -->
                    <div
                        class="notification-inbox"
                        id="notificationInbox"
                        style="display: none"
                    >
                        <div
                            class="notification-header flex justify-content-between align-items-center"
                        >
                            <h6>
                                <i class="fas fa-inbox me-2"></i>Notifications
                            </h6>
                            <button
                                class="btn-close-inbox"
                                onclick="closeNotificationInbox()"
                            >
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="notification-list" id="notificationList">
                            <div class="no-notifications">
                                <i class="fas fa-bell-slash"></i>
                                <p>No new notifications</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Profile -->
                <div class="user-profile" onclick="toggleUserMenu()">
                    <div class="user-avatar text-white">
                        {% if current_user.is_authenticated %} {{
                        current_user.username[0].upper() }} {% else %} G {%
                        endif %}
                    </div>
                    <div class="user-info">
                        <h6>
                            {% if current_user.is_authenticated %} {{
                            current_user.username }} {% else %} Guest User {%
                            endif %}
                        </h6>
                        <small>Trading Account</small>
                    </div>
                    <i
                        class="fas fa-chevron-down"
                        style="font-size: 0.75rem; color: var(--text-secondary)"
                    ></i>
                </div>
            </div>
        </header>

        <!-- Sidebar Overlay for Mobile -->
        <div
            class="sidebar-overlay"
            id="sidebarOverlay"
            onclick="toggleSidebar()"
        ></div>

        <!-- Fixed Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-nav">
                <div class="nav-item">
                    <a href="{{ url_for('portfolio') }}" class="nav-link">
                        <i class="fas fa-briefcase nav-icon"></i>
                        <span>Portfolio</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="{{ url_for('trading_signals') }}" class="nav-link">
                        <i class="fas fa-chart-bar nav-icon"></i>
                        <span>Trading Signals</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="{{ url_for('deals') }}" class="nav-link">
                        <i class="fas fa-handshake nav-icon"></i>
                        <span>Deals</span>
                    </a>
                </div>
                <!-- <div class="nav-item">
                <a href="/kotak" class="nav-link">
                    <i class="fas fa-chart-line nav-icon"></i>
                    <span>Kotak Neo Platform</span>
                </a>
            </div> -->
            </div>

            <!-- Trading Accounts Section -->
            <div class="trading-accounts-section">
                <div class="accounts-header">
                    <h6>
                        <i class="fas fa-university me-2"></i>Trading Accounts
                    </h6>
                </div>
                <div class="account-login">
                    <button class="btn-login-account">
                        <i class="fas fa-sign-in-alt me-2"></i>Login Account
                    </button>
                </div>
            </div>
        </nav>

        <!-- User Dropdown Menu -->
        <div
            class="dropdown-menu position-absolute"
            id="userMenu"
            style="
                display: none;
                top: var(--header-height);
                right: 1rem;
                min-width: 200px;
            "
        >
            <h6 class="dropdown-header">
                <i class="fas fa-user me-2"></i>Account Details
            </h6>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#" onclick="showUserProfile()">
                <i class="fas fa-id-card me-2"></i>View Profile
            </a>
            <div class="dropdown-divider"></div>
            {% if current_user.is_authenticated %}
            <a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
                <i class="fas fa-sign-out-alt me-2"></i>Logout
            </a>
            {% else %}
            <a class="dropdown-item text-primary" href="{{ url_for('login') }}">
                <i class="fas fa-sign-in-alt me-2"></i>Login
            </a>
            <a
                class="dropdown-item text-success"
                href="{{ url_for('register') }}"
            >
                <i class="fas fa-user-plus me-2"></i>Register
            </a>
            {% endif %}
        </div>

        <!-- User Profile Modal -->
        <div class="modal fade" id="userProfileModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header border-bottom border-secondary">
                        <h5 class="modal-title">
                            <i class="fas fa-user-circle me-2"></i>User Profile
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-4 text-center mb-4">
                                <div class="user-profile-avatar mb-3">
                                    <i
                                        class="fas fa-user-circle fa-5x text-primary"
                                    ></i>
                                </div>
                                <h4 class="text-muted">User Name</h4>
                                <span class="badge bg-success"
                                    >Active Trader</span
                                >
                            </div>
                            <div class="col-md-8">
                                <h6 class="text-primary mb-3">
                                    <i class="fas fa-info-circle me-2"></i
                                    >Account Information
                                </h6>
                                <div class="row">
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >UCC (User Code)</label
                                        >
                                        <div
                                            class="form-control bg-secondary text-muted border-0"
                                        >
                                            DEMO001
                                        </div>
                                    </div>
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >Account Status</label
                                        >
                                        <div
                                            class="form-control bg-success text-muted border-0"
                                        >
                                            <span class="text-muted"
                                                ><i
                                                    class="fas fa-check-circle me-1"
                                                ></i
                                                >Active & Authenticated</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >Login Time</label
                                        >
                                        <div
                                            class="form-control bg-secondary text-muted border-0"
                                        >
                                            <span id="loginTime">Today</span>
                                        </div>
                                    </div>
                                    <div class="col-sm-6 mb-3">
                                        <label class="form-label text-muted"
                                            >Client Code</label
                                        >
                                        <div
                                            class="form-control bg-secondary text-muted border-0"
                                        >
                                            NEO001
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="border-secondary" />

                        <h6 class="text-primary mb-3">
                            <i class="fas fa-shield-alt me-2"></i>Security &
                            Settings
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="list-group list-group-flush">
                                    <div
                                        class="list-group-item bg-transparent text-muted border-secondary"
                                    >
                                        <i
                                            class="fas fa-key me-2 text-success"
                                        ></i>
                                        Two-Factor Authentication:
                                        <span class="text-success"
                                            >Enabled</span
                                        >
                                    </div>
                                    <div
                                        class="list-group-item bg-transparent text-muted border-secondary"
                                    >
                                        <i
                                            class="fas fa-clock me-2 text-info"
                                        ></i>
                                        Session Timeout:
                                        <span class="text-info">24HR</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="list-group list-group-flush">
                                    <div
                                        class="list-group-item bg-transparent text-muted border-secondary"
                                    >
                                        <i
                                            class="fas fa-chart-line me-2 text-warning"
                                        ></i>
                                        Trading Status:
                                        <span class="text-success">Active</span>
                                    </div>
                                    <div
                                        class="list-group-item bg-transparent text-muted border-secondary"
                                    >
                                        <i
                                            class="fas fa-database me-2 text-primary"
                                        ></i>
                                        Data Refresh:
                                        <span class="text-info">Real-time</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal fade" id="settingsModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header border-bottom border-secondary">
                        <h5 class="modal-title">
                            <i class="fas fa-cog me-2"></i>Application Settings
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <!-- Font Size Settings -->
                        <div class="settings-section">
                            <h6>
                                <i class="fas fa-text-height"></i>
                                Font Size Settings
                            </h6>
                            <div class="settings-control-group">
                                <label for="fontSizeSelect">Font Size:</label>
                                <select id="fontSizeSelect" class="form-select">
                                    <option value="10">10px (Minimum)</option>
                                    <option value="11">11px</option>
                                    <option value="12">12px</option>
                                    <option value="13">13px</option>
                                    <option value="14" selected>
                                        14px (Default)
                                    </option>
                                    <option value="15">15px</option>
                                    <option value="16">16px</option>
                                    <option value="17">17px</option>
                                    <option value="18">18px</option>
                                    <option value="19">19px</option>
                                    <option value="20">20px (Maximum)</option>
                                </select>
                            </div>
                            <div class="font-size-preview">
                                <p>
                                    This is a preview of the selected font size.
                                    Your entire application will use this size.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Broker Selection Modal -->
        <div class="modal fade" id="loginAccountModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header border-bottom border-secondary">
                        <h5 class="modal-title">
                            <i class="fas fa-university me-2"></i>Choose Your
                            Broker
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                        ></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="row g-4">
                            <!-- Kotak Neo Card -->
                            <div class="col-md-6">
                                <div
                                    class="broker-card"
                                    onclick="redirectToKotakLogin()"
                                >
                                    <div class="broker-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h6 class="broker-name">Kotak Neo</h6>
                                    <p class="broker-description">
                                        Advanced trading platform with real-time
                                        data
                                    </p>
                                    <div class="broker-features">
                                        <span class="feature-tag"
                                            >TOTP Auth</span
                                        >
                                        <span class="feature-tag"
                                            >Real-time</span
                                        >
                                    </div>
                                </div>
                            </div>

                            <!-- Upstox Card -->
                            <div class="col-md-6">
                                <div
                                    class="broker-card"
                                    onclick="redirectToUpstoxLogin()"
                                >
                                    <div class="broker-icon upstox">
                                        <i class="fas fa-rocket"></i>
                                    </div>
                                    <h6 class="broker-name">Upstox</h6>
                                    <p class="broker-description">
                                        Fast and reliable trading experience
                                    </p>
                                    <div class="broker-features">
                                        <span class="feature-tag"
                                            >API Access</span
                                        >
                                        <span class="feature-tag"
                                            >Mobile First</span
                                        >
                                    </div>
                                </div>
                            </div>

                            <!-- Angel One Card -->
                            <div class="col-md-6">
                                <div
                                    class="broker-card"
                                    onclick="redirectToAngelLogin()"
                                >
                                    <div class="broker-icon angel">
                                        <i class="fas fa-feather-alt"></i>
                                    </div>
                                    <h6 class="broker-name">Angel One</h6>
                                    <p class="broker-description">
                                        Comprehensive trading and investment
                                        platform
                                    </p>
                                    <div class="broker-features">
                                        <span class="feature-tag"
                                            >SmartAPI</span
                                        >
                                        <span class="feature-tag"
                                            >Research</span
                                        >
                                    </div>
                                </div>
                            </div>

                            <!-- Zerodha Card -->
                            <div class="col-md-6">
                                <div
                                    class="broker-card"
                                    onclick="redirectToZerodhaLogin()"
                                >
                                    <div class="broker-icon zerodha">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <h6 class="broker-name">Zerodha</h6>
                                    <p class="broker-description">
                                        India's largest discount broker platform
                                    </p>
                                    <div class="broker-features">
                                        <span class="feature-tag"
                                            >Kite API</span
                                        >
                                        <span class="feature-tag"
                                            >Low Cost</span
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">{% block content %}{% endblock %}</main>

        <!-- Bootstrap 5 JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- SweetAlert2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- Custom JS -->
        <script src="{{ url_for('static', filename='js/base.js') }}"></script>

        {% block scripts %}{% endblock %}
    </body>
</html>
