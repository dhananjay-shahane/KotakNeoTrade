{% extends "base.html" %} {% block title %}Portfolio - Trading Signals{%
endblock %} {% block head %}
<link
    href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css"
    rel="stylesheet"
/>
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/skeleton_animation.css') }}"
/>
<style>
    .portfolio-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .portfolio-card:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
    }

    .metric-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    .metric-label {
        color: var(--text-secondary);
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
    }

    .change-positive {
        color: var(--success-color);
    }

    .change-negative {
        color: var(--danger-color);
    }

    .portfolio-summary-cards .card {
        background: linear-gradient(
            135deg,
            var(--card-bg) 0%,
            rgba(255, 255, 255, 0.05) 100%
        );
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }

    .portfolio-summary-cards .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .stats-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .chart-container {
        position: relative;
        height: 300px;
        margin: 20px 0;
    }

    .quick-actions .btn {
        border-radius: 12px;
        padding: 12px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .quick-actions .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .signals-table {
        background: var(--card-bg);
        border-radius: 0.75rem;
        overflow: hidden;
    }

    .table-dark {
        --bs-table-bg: var(--card-bg);
        --bs-table-color: var(--text-primary);
        --bs-table-border-color: var(--border-color);
    }

    .signal-status {
        padding: 4px 8px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .signal-active {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success-color);
    }

    .signal-closed {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger-color);
    }

    .welcome-header {
        background: linear-gradient(
            135deg,
            #667eea 0%,
            #764ba2 100%
        ) !important;
        color: white !important;
        border: none !important;
        border-radius: 0.75rem !important;
    }

    .signal-pnl-positive {
        color: var(--success-color);
        font-weight: 600;
    }

    .signal-pnl-negative {
        color: var(--danger-color);
        font-weight: 600;
    }

    /* Project Management Dashboard Styles */
    .project-summary-card {
        border-left: 4px solid var(--primary-color);
        transition: all 0.3s ease;
    }

    .project-summary-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .project-icon {
        font-size: 1.5rem;
        opacity: 0.7;
    }

    .chart-container {
        position: relative;
        height: 250px;
        padding: 1rem 0;
    }

    .progress-container {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 120px;
    }

    .progress-container .progress {
        flex: 1;
        border-radius: 10px;
    }

    .progress-text {
        font-size: 0.8rem;
        font-weight: 600;
        min-width: 35px;
    }

    #projectTable {
        font-size: 0.875rem;
    }

    #projectTable th {
        font-weight: 600;
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
        font-size: 0.8rem;
        padding: 0.75rem 0.5rem;
    }

    #projectTable td {
        padding: 0.75rem 0.5rem;
        vertical-align: middle;
    }

    .badge {
        font-size: 0.7rem;
        padding: 0.3rem 0.5rem;
    }

    /* Light theme adjustments */
    :root[data-theme="light"] .project-summary-card {
        background: #ffffff;
        border-color: var(--primary-color);
    }

    :root[data-theme="light"] #projectTable th {
        background-color: #f8f9fa;
        color: #495057;
    }
</style>
{% endblock %} {% block content %}
<div class="container-fluid">
    <!-- Welcome Section - Hidden during skeleton loading -->
    <!-- Content Container with relative positioning -->
    <div style="position: relative; min-height: 600px">
        <!-- Portfolio Skeleton Loading -->
        <div id="portfolioSkeleton" class="skeleton-loading">
            <!-- Welcome Header Skeleton -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="skeleton-welcome-header">
                        <div class="card-body p-4">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-center">
                                        <div
                                            class="skeleton-welcome-avatar me-3"
                                        ></div>
                                        <div>
                                            <div
                                                class="skeleton-welcome-title"
                                            ></div>
                                            <div
                                                class="skeleton-welcome-subtitle"
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div
                                        class="d-flex gap-2 justify-content-end"
                                    >
                                        <div class="skeleton-welcome-btn"></div>
                                        <div class="skeleton-welcome-btn"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table Header Skeleton -->
            <div class="row mb-4">
                <div class="col-4">
                    <div class="skeleton skeleton-summary-card"></div>
                    <div class="skeleton skeleton-summary-card"></div>
                    <div class="skeleton skeleton-summary-card"></div>
                </div>
                <div class="col-4">
                    <div
                        class="skeleton skeleton-portfolio-card"
                        style="height: 400px"
                    ></div>
                </div>
                <div class="col-4">
                    <div
                        class="skeleton skeleton-portfolio-card"
                        style="height: 400px"
                    ></div>
                </div>
            </div>

            <!-- Table Rows Skeleton -->
            <div class="row">
                <div class="col-12">
                    <div class="skeleton skeleton-table-row"></div>
                    <div class="skeleton skeleton-table-row"></div>
                    <div class="skeleton skeleton-table-row"></div>
                    <div class="skeleton skeleton-table-row"></div>
                    <div class="skeleton skeleton-table-row"></div>
                </div>
            </div>

            <!-- Activity Card Skeleton -->
            <div class="row mt-4">
                <div class="col-md-8 mb-4">
                    <div class="skeleton skeleton-portfolio-card"></div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="skeleton skeleton-portfolio-card"></div>
                </div>
            </div>
        </div>

        <div id="portfolioContent">
            <div class="row mb-4 content-loading" id="portfolioWelcomeSection">
                <div class="col-12">
                    <div class="card welcome-header">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-center">
                                        <div class="user-avatar-large me-3">
                                            <i
                                                class="fas fa-chart-line fa-3x text-white"
                                            ></i>
                                        </div>
                                        <div>
                                            <h3 class="text-white mb-1">
                                                Portfolio
                                            </h3>
                                            <p class="text-white-50 mb-0">
                                                <i
                                                    class="fas fa-clock me-1"
                                                ></i>
                                                Last updated:
                                                <span id="lastUpdateTime"
                                                    >Just now</span
                                                >
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div
                                        class="d-flex gap-2 justify-content-end"
                                    >
                                        <a
                                            href="/trading-signals"
                                            class="btn btn-outline-light"
                                        >
                                            <i class="fas fa-signal me-1"></i
                                            >All Signals
                                        </a>
                                        <button
                                            class="btn btn-outline-light"
                                            onclick="refreshSignals()"
                                        >
                                            <i class="fas fa-sync me-1"></i
                                            >Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mb-4">
                <div class="col-md-4 mb-4">
                    <div class="mb-3">
                        <div class="card border-0 h-100 project-summary-card">
                            <div class="card-body">
                                <div
                                    class="d-flex justify-content-between align-items-start"
                                >
                                    <div>
                                        <h6 class="text-muted mb-2">
                                            Total Deals
                                        </h6>
                                        <h2 class="text-primary mb-0">20</h2>
                                    </div>
                                    <div class="project-icon">
                                        <i
                                            class="fas fa-project-diagram text-primary"
                                        ></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="card border-0 h-100 project-summary-card">
                            <div class="card-body">
                                <div
                                    class="d-flex justify-content-between align-items-start"
                                >
                                    <div>
                                        <h6 class="text-muted mb-2">
                                            Active Deals
                                        </h6>
                                        <h2 class="text-info mb-0">10</h2>
                                    </div>
                                    <div class="project-icon">
                                        <i class="fas fa-tasks text-info"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="card border-0 h-100 project-summary-card">
                            <div class="card-body">
                                <div
                                    class="d-flex justify-content-between align-items-start"
                                >
                                    <div>
                                        <h6 class="text-muted mb-2">
                                            Close Deals
                                        </h6>
                                        <h2 class="text-danger mb-0">6</h2>
                                    </div>
                                    <div class="project-icon">
                                        <i
                                            class="fas fa-check-circle text-success"
                                        ></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project Progress Pie Chart -->
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="mb-0">Deals progress</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas
                                    id="projectProgressChart"
                                    width="200"
                                    height="200"
                                ></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks by Project Bar Chart -->
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="mb-0">Deals Data</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas
                                    id="tasksByProjectChart"
                                    width="300"
                                    height="200"
                                ></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project by Manager Donut Chart -->
                <!-- <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h6 class="mb-0">Project by Project Manager</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="projectByManagerChart" width="200" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>

            <!-- Project Management Table -->
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">Project Management Overview</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table
                                    class="table table-hover mb-0"
                                    id="projectTable"
                                >
                                    <thead class="table-light">
                                        <tr>
                                            <th>Project</th>
                                            <th>Project Manager</th>
                                            <th>Start</th>
                                            <th>Finish</th>
                                            <th>Progress</th>
                                            <th>Effort(hours)</th>
                                            <th>Task Count</th>
                                            <th>Overdue Tasks</th>
                                            <th>Late Tasks</th>
                                            <th>On Track Tasks</th>
                                            <th>Future Tasks</th>
                                            <th>Completed Tasks</th>
                                        </tr>
                                    </thead>
                                    <tbody id="projectTableBody">
                                        <tr>
                                            <td>
                                                <strong
                                                    >Community Survey Light rail
                                                    P2</strong
                                                >
                                            </td>
                                            <td>Eva Hebert</td>
                                            <td>07-Nov-22</td>
                                            <td>20-Dec-22</td>
                                            <td>
                                                <div class="progress-container">
                                                    <div
                                                        class="progress"
                                                        style="height: 8px"
                                                    >
                                                        <div
                                                            class="progress-bar bg-primary"
                                                            style="width: 0%"
                                                        ></div>
                                                    </div>
                                                    <span class="progress-text"
                                                        >0%</span
                                                    >
                                                </div>
                                            </td>
                                            <td>440</td>
                                            <td>24</td>
                                            <td>
                                                <span class="badge bg-danger"
                                                    >24</span
                                                >
                                            </td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <strong
                                                    >Email Campaign Wave
                                                    1</strong
                                                >
                                            </td>
                                            <td>Eva Hebert</td>
                                            <td>18-Sep-22</td>
                                            <td>22-Oct-22</td>
                                            <td>
                                                <div class="progress-container">
                                                    <div
                                                        class="progress"
                                                        style="height: 8px"
                                                    >
                                                        <div
                                                            class="progress-bar bg-success"
                                                            style="width: 100%"
                                                        ></div>
                                                    </div>
                                                    <span class="progress-text"
                                                        >100%</span
                                                    >
                                                </div>
                                            </td>
                                            <td>206</td>
                                            <td>25</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>
                                                <span class="badge bg-success"
                                                    >25</span
                                                >
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <strong>Rider Survey</strong>
                                            </td>
                                            <td>Eva Hebert</td>
                                            <td>02-Sep-22</td>
                                            <td>31-Oct-22</td>
                                            <td>
                                                <div class="progress-container">
                                                    <div
                                                        class="progress"
                                                        style="height: 8px"
                                                    >
                                                        <div
                                                            class="progress-bar bg-warning"
                                                            style="width: 18%"
                                                        ></div>
                                                    </div>
                                                    <span class="progress-text"
                                                        >18%</span
                                                    >
                                                </div>
                                            </td>
                                            <td>1,217</td>
                                            <td>25</td>
                                            <td>
                                                <span class="badge bg-danger"
                                                    >17</span
                                                >
                                            </td>
                                            <td>
                                                <span class="badge bg-info"
                                                    >2</span
                                                >
                                            </td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>
                                                <span class="badge bg-success"
                                                    >1</span
                                                >
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <strong
                                                    >Support mobile account
                                                    inquiry</strong
                                                >
                                            </td>
                                            <td>Eva Hebert</td>
                                            <td>29-Aug-22</td>
                                            <td>25-Nov-22</td>
                                            <td>
                                                <div class="progress-container">
                                                    <div
                                                        class="progress"
                                                        style="height: 8px"
                                                    >
                                                        <div
                                                            class="progress-bar bg-info"
                                                            style="width: 75%"
                                                        ></div>
                                                    </div>
                                                    <span class="progress-text"
                                                        >75%</span
                                                    >
                                                </div>
                                            </td>
                                            <td>2,596</td>
                                            <td>7</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>
                                                <span class="badge bg-primary"
                                                    >3</span
                                                >
                                            </td>
                                            <td>-</td>
                                            <td>
                                                <span class="badge bg-success"
                                                    >5</span
                                                >
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <strong
                                                    >Track upgrades (miles 3
                                                    thru 6)</strong
                                                >
                                            </td>
                                            <td>Eva Hebert</td>
                                            <td>07-Oct-22</td>
                                            <td>04-Nov-22</td>
                                            <td>
                                                <div class="progress-container">
                                                    <div
                                                        class="progress"
                                                        style="height: 8px"
                                                    >
                                                        <div
                                                            class="progress-bar bg-warning"
                                                            style="width: 29%"
                                                        ></div>
                                                    </div>
                                                    <span class="progress-text"
                                                        >29%</span
                                                    >
                                                </div>
                                            </td>
                                            <td>764</td>
                                            <td>22</td>
                                            <td>
                                                <span class="badge bg-danger"
                                                    >9</span
                                                >
                                            </td>
                                            <td>
                                                <span class="badge bg-info"
                                                    >3</span
                                                >
                                            </td>
                                            <td>
                                                <span class="badge bg-primary"
                                                    >5</span
                                                >
                                            </td>
                                            <td>-</td>
                                            <td>
                                                <span class="badge bg-success"
                                                    >5</span
                                                >
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Set portfolio nav link as active
        const portfolioLink = document.querySelector('a[href*="portfolio"]');
        if (portfolioLink) {
            document.querySelectorAll(".nav-link").forEach((link) => {
                link.classList.remove("active");
            });
            portfolioLink.classList.add("active");
        }

        // Check if user just logged out from Kotak and update UI accordingly
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("kotak_logout") === "true") {
            // Hide Kotak sections and show login option
            const kotakAccountBox = document.getElementById("kotakAccountBox");
            const kotakNeoSection = document.getElementById("kotakNeoSection");
            const accountLogin = document.getElementById("accountLogin");

            if (kotakAccountBox) kotakAccountBox.style.display = "none";
            if (kotakNeoSection) kotakNeoSection.style.display = "none";
            if (accountLogin) accountLogin.style.display = "block";
        }

        // Initialize project management charts
        initializeProjectCharts();

        // Auto-refresh functionality can be added here for project data
        // setInterval(refreshProjectData, 30000);
    });

    function initializeProjectCharts() {
        // Project Progress Pie Chart
        const progressCtx = document.getElementById("projectProgressChart");
        if (progressCtx) {
            new Chart(progressCtx, {
                type: "doughnut",
                data: {
                    labels: ["Not Started", "In Progress", "Completed"],
                    datasets: [
                        {
                            data: [2, 15, 3],
                            backgroundColor: ["#dc3545", "#6c757d", "#198754"],
                            borderWidth: 0,
                            cutout: "60%",
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: "bottom",
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 11,
                                },
                            },
                        },
                    },
                },
            });
        }

        // Tasks by Project Bar Chart
        const tasksCtx = document.getElementById("tasksByProjectChart");
        if (tasksCtx) {
            new Chart(tasksCtx, {
                type: "bar",
                data: {
                    labels: [
                        "Onboarding",
                        "Supervisor",
                        "Technical",
                        "Survey",
                        "Lab",
                        "Training",
                        "Migration",
                        "Onboarding",
                        "Helpdesk",
                        "Events",
                    ],
                    datasets: [
                        {
                            label: "Not Completed",
                            data: [
                                1200, 1400, 1300, 1100, 900, 1100, 1500, 800,
                                700, 600,
                            ],
                            backgroundColor: "#dc3545",
                        },
                        {
                            label: "Not Remaining",
                            data: [
                                800, 600, 700, 900, 1100, 900, 500, 1200, 1300,
                                1400,
                            ],
                            backgroundColor: "#6c757d",
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    size: 10,
                                },
                            },
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    size: 10,
                                },
                            },
                        },
                    },
                    plugins: {
                        legend: {
                            position: "top",
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 11,
                                },
                            },
                        },
                    },
                },
            });
        }

        // Project by Manager Donut Chart
        const managerCtx = document.getElementById("projectByManagerChart");
        if (managerCtx) {
            new Chart(managerCtx, {
                type: "doughnut",
                data: {
                    labels: [
                        "360 listeners",
                        "Madelyn",
                        "Greta Othman",
                        "Kasey Ba",
                        "Marco Christmas",
                        "Eva Hebert",
                    ],
                    datasets: [
                        {
                            data: [1, 1, 2, 10, 3, 3],
                            backgroundColor: [
                                "#ff6b6b",
                                "#4ecdc4",
                                "#45b7d1",
                                "#96ceb4",
                                "#feca57",
                                "#ff9ff3",
                            ],
                            borderWidth: 0,
                            cutout: "60%",
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: "right",
                            labels: {
                                usePointStyle: true,
                                padding: 10,
                                font: {
                                    size: 10,
                                },
                            },
                        },
                    },
                },
            });
        }
    }

    // Project Management Dashboard Functions
    function refreshProjectData() {
        // Function to refresh project data if needed
        console.log("Refreshing project data...");
        // This can be implemented to fetch real project data from API
    }

    function viewProjectDetails(projectId) {
        // Function to view project details
        console.log("Viewing project details for:", projectId);
        // This can be implemented to show project details modal or navigate to project page
    }

    // Chart period selection
    document.addEventListener("click", function (e) {
        if (e.target.hasAttribute("data-period")) {
            document
                .querySelectorAll("[data-period]")
                .forEach((btn) => btn.classList.remove("active"));
            e.target.classList.add("active");

            const period = e.target.getAttribute("data-period");
            console.log("Loading data for period:", period);
            // Implement period-based data loading here
        }
    });
</script>
{% endblock %}
